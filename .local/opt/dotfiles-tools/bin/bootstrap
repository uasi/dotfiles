#!/bin/sh

set -ex

echo "Installing dotfiles..."

git clone --bare https://github.com/uasi/dotfiles.git "$HOME/.dotfiles.git"
git --git-dir="$HOME/.dotfiles.git" --work-tree="$HOME" checkout master

echo "Installing mitamae..."

"$HOME/.local/opt/dotfiles-tools/bin/bootstrap-mitamae"

echo "Installing essentials..."

"$HOME/bin/mitamae" "$HOME/.local/opt/dotfiles-tools/share/recipe-essentials.rb"

echo "Installing deno..."

DENO_INSTALL=$HOME curl -fsSL https://deno.land/x/install/install.sh | sh

cat <<'END'

Completed.

If you want to load secret env from Keychain,

    1. open Keychain Access.app and create a secure note with title "secret-shell-env", and
    2. run `~/.local/opt/dotfiles-tools/bin/print-secure-note secret-shell-env` and click "Always Allow", and
    3. run `cp ~/.local/opt/dotfiles-tools/share/envrc.sample ~/.envrc`.
END
